<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl">
  <title data-ice="title">Home | create-graphql-server-authorization</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Adds authorization to create-graphql-server"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="create-graphql-server-authorization"><meta property="twitter:description" content="Adds authorization to create-graphql-server"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/tobkle/create-graphql-server-authorization"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ASC">ASC</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-BOOLEAN">BOOLEAN</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-BSON_TYPE">BSON_TYPE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_LIMIT">DEFAULT_LIMIT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_SKIP">DEFAULT_SKIP</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_SORT">DEFAULT_SORT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DESC">DESC</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ENCODING">ENCODING</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ENUM">ENUM</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-FLOAT">FLOAT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-INT">INT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-QUERY">QUERY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-REGEX">REGEX</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SRC_DIR">SRC_DIR</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-STRING">STRING</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TEST_DIR">TEST_DIR</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TEST_EXPECTED">TEST_EXPECTED</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TEST_GENERATED">TEST_GENERATED</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TEST_GQL_DATA">TEST_GQL_DATA</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TEST_GQL_EXTENSION">TEST_GQL_EXTENSION</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-modulePath">modulePath</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#model">model</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-buildBaseQuery">buildBaseQuery</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-buildFilterQuery">buildFilterQuery</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-buildLimit">buildLimit</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-buildSkip">buildSkip</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-buildSortQuery">buildSortQuery</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-prepareQueries">prepareQueries</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#schema">schema</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-buildRequiredTypes">buildRequiredTypes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-enhanceSchemaWithQueryArguments">enhanceSchemaWithQueryArguments</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#util">util</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-lcFirst">lcFirst</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ucFirst">ucFirst</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-addPaginationArguments">addPaginationArguments</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-applyCustomDirectives">applyCustomDirectives</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-argumentsToObject">argumentsToObject</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-buildArgument">buildArgument</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-buildField">buildField</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-buildName">buildName</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-buildTypeDefinition">buildTypeDefinition</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-buildTypeExtension">buildTypeExtension</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-buildTypeReference">buildTypeReference</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-buildValue">buildValue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getBaseType">getBaseType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getType">getType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-idArgument">idArgument</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isScalarField">isScalarField</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-readInput">readInput</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-readString">readString</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-templateToAst">templateToAst</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SCALAR_TYPE_NAMES">SCALAR_TYPE_NAMES</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><div data-ice="index" class="github-markdown"><p><a href="http://badge.fury.io/js/create-graphql-server-query-arguments"><img src="https://badge.fury.io/js/create-graphql-server-query-arguments.svg" alt="npm version"></a> <a href="https://travis-ci.org/tobkle/create-graphql-server-query-arguments"><img src="https://travis-ci.org/tobkle/create-graphql-server-query-arguments.svg?branch=master" alt="Build Status"></a> <a href="https://coveralls.io/github/tobkle/create-graphql-server-query-arguments?branch=master"><img src="https://coveralls.io/repos/github/tobkle/create-graphql-server-query-arguments/badge.svg?branch=master" alt="Coverage Status"></a></p>
<h1 id="create-graphql-server-query-arguments">create-graphql-server-query-arguments</h1><p>Build query arguments for filter and orderBy MongoDB queries.</p>
<p>Added 61 test cases, which pass against my local server.
TODO: There can be more test cases, with complex queries and a critical review of the tests.
TODO: test app to run those test cases against. Used so far my local server.
TODO: When server is up and running: rename src/<strong>tests</strong>/end-to-end/index-test-cases.js back to index-test-cases-test.js, in order to have it in the test run with Mocha.</p>
<h2 id="purpose">Purpose</h2><p>You build a GraphQL server with the npm package &quot;create-graphql-server&quot;, which serves as a backend to web applications. This &quot;create-graphql-server&quot; generates schemas, resolvers and models for an express-js server.</p>
<p>As soon as you are building the web application on top of this server, you want to access this backend server with specific GraphQL queries. Sometimes you want to set filters, to get just filtered records. Sometimes you want to sort data by different fields in ascending or descending order. Sometimes you want just pages of data with the first ten data records, or just the second page after the first ten records and so on.</p>
<p>In order to enable such accesses to your GraphQL server backend, the schema needs to provide query arguments such as: </p>
<ul>
<li>filter</li>
<li>orderBy</li>
<li>limit</li>
<li>skip</li>
</ul>
<p>TODO: as enhanced version of limit and skip:</p>
<ul>
<li>first </li>
<li>before </li>
<li>last</li>
<li>after</li>
</ul>
<p>Additionally, your data model must know, how to map these query arguments into valid database queries for the mongoDB database.</p>
<p>That&apos;s the purpose of this module. </p>
<ul>
<li>it provides a function for the schema generator, to generate additional query arguments</li>
<li>it provides a function for basic types for all arguments later</li>
<li>it provides a function for the data model, to map query arguments, into a database query</li>
</ul>
<p>GraphQL query argument to mongoDB mapper:</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">const { baseQuery, sortQuery, skip, limit} = prepareQueries( query_arguments )</code>
</code></pre>
<p>GraphQL schema Query argument generator:</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">buildRequiredTypes();</code>
</code></pre>
<p>GraphQL schema Query argument generator:</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">const enhancedOutputSchema = enhanceSchemaWithQueryArguments( inputSchema );</code>
</code></pre>
<p>It provides the following query arguments:</p>
<h3 id="orderby">orderBy</h3><p>All fields of the type definitions are automatically added to the orderBy sort field selection, except for associations to other types.</p>
<h3 id="limit">limit</h3><p>A limit argument is added, to choose the number of documents/records the query should return.</p>
<h3 id="skip">skip</h3><p>A skip argument is added, to skip a number of found records, not to be returned by the query.</p>
<h3 id="filter">filter</h3><p>The following filter query arguments are added to list types, which you can use to build complex queries:</p>
<ul>
<li>eq </li>
<li>all</li>
<li>ne</li>
<li>in</li>
<li>nin</li>
<li>lt</li>
<li>lte</li>
<li>gt</li>
<li>gte</li>
<li>regex</li>
<li>contains</li>
<li>starts_with</li>
<li>ends_with</li>
<li>not_contains</li>
<li>not_starts_with</li>
<li>not_ends_with</li>
<li>not_in</li>
<li>exists</li>
<li>not </li>
<li>type</li>
<li>AND</li>
<li>NOR</li>
<li>OR</li>
</ul>
<h2 id="installation">Installation</h2><h3 id="installation-part-1----add-the-module-to-create-graphql-server-project">Installation Part 1 -- add the module to create-graphql-server project</h3><pre><code class="lang-bash"><code class="source-code prettyprint">yarn add create-graphql-server-query-arguments</code>
</code></pre>
<h3 id="installation-part-2----add-it-to-the-server-for-the-mongodb-accesses">Installation Part 2 -- add it to the server for the mongoDB accesses</h3><p>Add this module to your express server in &quot;create-graphql-server/skel/server/index.js&quot; and provide it to your data model by:</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">...
import { prepareQueries } from &apos;create-graphql-server-query-arguments&apos;;
...</code>
</code></pre>
<p>... and also in skel/server/index.js add it it your your data model context by...</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">...
app.use(&apos;/graphql&apos;, (req, res, next) =&gt; {
  passport.authenticate(&apos;jwt&apos;, { session: false }, (err, me) =&gt; {
    req.context = addModelsToContext({
      db, pubsub, me, UserCollection, log, prepareQueries    // &lt;===
    });
    graphqlExpress(() =&gt; {
        ...
    })
  });
})
...</code>
</code></pre>
<p>Now you can access it in your data models with &quot;this.context.prepareQueries&quot;:</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">find(args, me, resolver) {
  const { baseQuery, sortQuery, skip, limit} = this.context.prepareQueries( args ); // &lt;===
  const authQuery = queryForRoles(/* auth logic here */);
  const finalQuery = { ...baseQuery, ...authQuery };
  return this.collection
    .find(finalQuery)
    .sort(sortQuery)
    .skip(skip)
    .limit(limit)
    .toArray();
}</code>
</code></pre>
<p>Be sure, that also the resolver(s) pass on all &quot;args&quot; to your model method &quot;find&quot;.</p>
<p>Add these adjustments also to your: &quot;test/output-app/server/index.js&quot;, otherwise your test runs will fail, as it compares the generated app files from &quot;skel&quot; with this &quot;output-app&quot; files.</p>
<h3 id="installation-part-3----general-type-definitions-for-all-arguments--but-can-be-defined-only-once">Installation Part 3 -- General Type Definitions for all arguments, but can be defined only once</h3><p>add to file &quot;skel/schema/index.js&quot;</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">...
import { buildRequiredTypes } from &apos;create-graphql-server-query-arguments&apos;; // &lt;=== add this line
...
const typeDefs = [`
  scalar ObjID
  type Query {
    # A placeholder, please ignore
    __placeholder: Int
  }
  type Mutation {
    # A placeholder, please ignore
    __placeholder: Int
  }
  type Subscription {
    # A placeholder, please ignore
    __placeholder: Int
  }
`];

typeDefs.push(buildRequiredTypes()); // &lt;=== add this line

export default typeDefs;
...</code>
</code></pre>
<p>Caution: Do the same again in the &quot;test/output-app/schema/index.js&quot; to have proper test runs.</p>
<h3 id="installation-part-4----generator-for-schema-for-individual-argument-type-definitions">Installation Part 4 -- Generator for Schema for individual argument type definitions</h3><p>Add to file &quot;generate/schema/index.js&quot; the following two statements:</p>
<pre><code class="lang-javascript"><code class="source-code prettyprint">...
import { 
    enhanceSchemaWithQueryArguments 
} from &apos;create-graphql-server-query-arguments&apos;; // &lt;== here
...
...
  // at the end enhance with query arguments...
  const outputSchemaWithArguments = enhanceSchemaWithQueryArguments(outputSchemaWithAuth); // &lt;== here

  return outputSchemaWithArguments; // &lt;== here
}</code>
</code></pre>
<p>Add those types to your outputSchema.</p>
<h2 id="documentation">Documentation</h2><p><a href="https://tobkle.github.io/create-graphql-server-query-arguments/">API Documentation</a></p>
<h2 id="tests">Tests</h2><pre><code class="lang-bash"><code class="source-code prettyprint">yarn test</code>
</code></pre>
<h2 id="contributing">Contributing</h2><p>In lieu of a formal style guide, take care to maintain the existing coding style. Add unit tests for any new or changed functionality. Lint and test your code.</p>
<h1 id="example-queries">Example Queries</h1><pre><code class="lang-javascript"><code class="source-code prettyprint"></code>
</code></pre>
<p>Have a look in the test directory to see more:
<a href="https://github.com/tobkle/create-graphql-server-query-arguments/tree/master/src/__tests__/end-to-end/">index-test-cases</a></p>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.1)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
